<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="Author" content="kiwon">
    <meta name="keywords" content="R, Programming Engineering">
    <meta name="description" content="Programming Application, 프로그래밍 응용 수업">
    <meta name="og:title" content="USEWORLD">
    <meta name="og:type" content="university">
    <meta name="og:url" content="http://kiwon.github.io/se.ProgrammingApplication//">

    <!--    <meta name="viewport" content="width=1280">-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <title>Programming Application: week.06 데이터 파일 및 구조 Data File and Structure</title>

    <!-- icon -->
    <link rel="shortcut icon" href="../../img/poster.r.png">
    <link rel="apple-touch-icon" href="../../img/poster.r.png">


    <!--    addThis-->
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5416a0751fa00b83"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" href="../../css/custom.css">

    <!-- JavaScript -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="../../js/bootstrap.min.js"></script>
    <script src="../../js/custom.js"></script>
    <!-- Basic layout and information -->
    <!--code syntax highlight-->
    <link rel="stylesheet" href="../../css/monokai_sublime.css">
    <script src="../../js/highlight.pack.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
    </script>

    <!--
        Information
        describe page information

    -->
    <base target="_blank">
</head>

<body>
    <div class="top"></div>
    <div class="container" id="cs-nav">
        <a target="_self" class="navbar-brand" id="cs-home" href="../../">Programming Application</a>
        <button class="navbar-toggle" data-toggle="collapse" data-target=".navHeaderCollapse"> F

        </button>

        <div class="collapse navbar-collapse navHeaderCollapse">
            <ul class="nav navbar-nav">
                <li><a target="_self" href="../syllabus">SYLLABUS</a>
                </li>
                <li><a target="_self" href="../start">START</a>
                </li>

                </li>
                <li class="dropdown">
                    <a target="_self" class="dropdown-toggle" data-toggle="dropdown" href="#">COURSE
          <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a target="_self" href="../week01">week.01 : 공학프로그래밍의 이해</a>
                        </li>
                        <li><a target="_self" href="../week02">week.02 : Linux/Unix-Like OS 및 응용 소프트웨어</a>
                        </li>
                        <li><a target="_self" href="../week03">week.03 : 웹과 위키시스템</a>
                        </li>
                        <li><a target="_self" href="../week04">week.04 : R 프로그래밍 및 개발환경</a>
                        </li>
                        <li><a target="_self" href="../week05">week.05 : R 프로그래밍 기초 및 데이터 타입</a>
                        </li>
                        <li><a target="_self" href="../week06">week.06 : 데이터 파일 및 구조</a>
                        </li>
                        <li><a target="_self" href="../week07">week.07 : 그래픽 구현</a>
                        </li>
                        <li><a target="_self" href="../week08">week.08 : R 함수 및 패키지</a>
                        </li>
                        <li><a target="_self" href="../week09">week.09 : 중간고사</a> </li>
                        <li><a target="_self" href="../week10">week.10 : R 언어를 이용한 수치(개방법)</a> </li>
                        <li><a target="_self" href="../week11">week.11 : R 언어를 이용한 수치해석(보간법)</a> </li>
                        <li><a target="_self" href="../week12">week.12 : R 언어를 이용한 수치해석(회귀분석)</a> </li>
                        <li><a target="_self" href="../week13">week.13 : R 언어를 이용한 수치해석(수치 미분)</a> </li>
                        <li><a target="_self" href="../week14">week.14 : R 언어를 이용한 수치해석(수치 적분)</a> </li>
                        <li><a target="_self" href="../week15">week.15 : 최종 프로젝트 발표 및 토론</a> </li>
                    </ul>
                </li>

            </ul>


        </div>
    </div>
    <div class="container">




        <section class="row">




            <div class="block toc">
                <!--start of toc-->


                <h1><strong>Week.06</strong> : 데이터 파일 및 구조 <small>Data File and Structure</small></h1>
                <b>Table of Contents</b>
                <ul class="numeric-decimals">
                    <li>
                        <a target="_self" href="#data-input-output">데이터 입출력 <small>Data Input Output</small>
                        </a>
                        <ul>
                            <li>
                                <a target="_self" href="#csv-input-output">CSV 입출력 <small>Comma Separated Values File Input Output</small>
                                </a>
                                <ul>
                                    <li>
                                        <a target="_self" href="#csv-reading">CSV 읽기 <small>CSV Reading</small>
                                        </a>
                                    </li>
                                    <li>
                                        <a target="_self" href="#csv-writing">CSV 쓰기 <small>CSV Writing</small>
                                        </a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a target="_self" href="#data-management">데이터 다루기 <small>Data Management</small>
                        </a>
                        <ul>
                            <li>
                                <a target="_self" href="#about-the-data">데이터 설명 <small>About the Data</small>
                                </a>
                            </li>
                            <li>
                                <a target="_self" href="#importing-data">Importing Data
                                </a>
                            </li>
                            <li>
                                <a target="_self" href="#exporting-data">Exporting Data
                                </a>
                            </li>

                            <li>
                                <a target="_self" href="#information-of-data">Information of Data
                                </a>
                            </li>
                            <li>
                                <a target="_self" href="#count-the-rainy-day">Count the Rainy Day
                                </a>
                            </li>
                            <li>
                                <a target="_self" href="#removing-base-flow-from-discharge">Removing Base Flow From Discharge
                                </a>
                            </li>
                            <li>
                                <a target="_self" href="#delete-attribute-name-of-list">Dlelete Attribute Names Of List
                                </a>
                            </li>
                            <li>
                                <a target="_self" href="#exporting-data-information">Exporting Data Information
                                </a>
                            </li>
                        </ul>
                    </li>
                </ul>

            </div>
            <!--end of toc-->



            <div class="block ">
                <!-- start of contents-->
                <h1 id="data-file-and-structure">데이터 파일 및 구조 <small>Data File and Structure</small></h1>

                <br>

                <h2 id="data-input-output">데이터 입출력 <small>Data Input Output</small></h2>

                <br>

                <h3 id="csv-input-output">CSV 입출력 <small>Comma Separated Values File Input Output</small></h3>

                <p>
                    <u>CSV FIle</u> : <b>C</b>omma <b>S</b>eparated <b>V</b>alues File
                    <br> 파일을 가장 빠르게 읽고 쓰는 파일포맷은 바이너리(binary) 파일이다. 많은 양의 데이터는 바이너리 파일로 처리하는 것이 빠르나, 바이너리코드 출력 도구가 없이는 데이터 확인이 힘들어서 대부분 ASCII(<b>A</b>merican <b>S</b>tandard <b>C</b>ode for <b>I</b>nformation <b>I</b>nterchange)파일 포맷을 사용하여 데이터를 저장한다. 그 중 데이터 입출력이 편하고 데이터 용량도 크게 찾이하지 않는 CSV(<b>C</b>omma <b>S</b>eparated <b>V</b>alues)파일 포맷을 많이 사용한다. 여기서는 CSV 파일 입출력을 다루어 보도록 한다.
                </p>

                <h4 id="csv-reading">CSV 읽기 <small>CSV Reading</small></h4>

                    <pre style="padding-left: 30pt">
x &lt;- read.csv ("./data/rr.csv")
</pre>

                    <br>

                    <h4 id="csv-writing">CSV 쓰기 <small>CSV Writing</small></h4>

                    <pre style="padding-left: 30pt">write.csv(x, "./data/rr.copy.csv", row.names=F)
# row.names=F : without row names.
</pre>

                    <br>

                    <h2 id="data-management">데이터 다루기 <small>Data Management</small></h2>

                    <p>
                        기본적인 데이터 전처리 예제를 통해 실습을 해본다.
                    </p>

                    <h3 id="about-the-data">데이터 설명 <small>About the Data</small></h3>

                    <p>
                        <b>ex.data</b>.<u>r</u> : 예제 R script
                        <br>
                        <b>data.rain</b>.<u>csv</u> : 강우량 자료
                        <br>
                        <b>data.flow</b>.<u>csv</u> : 유출량 자료
                        <br>
                        <b>rr.unified</b>.<u>csv</u> : 강우량과 유출량 자료를 하나의 파일로 합친 자료
                        <br>
                        <b>data.info</b>.<u>txt</u> : 데이터 정보를 담은 자료
                    </p>
<br><br>
                    <p>
                        <b>ex.data</b>.<u>r</u>
                    </p>

                    <pre><code class="r">
	    
# Importing Data -------------------------------------------------------------

rm(list = ls()) # Remove all variable
datRain <- read.csv("./data.rain.csv")
datFlow <- read.csv("./data.flow.csv")

class(datRain) # checking class
class(datFlow) # checking class

# Exporting Data ----------------------------------------------------------

dat <- cbind(datRain, datFlow[,2]) # binding data
names(dat)[3] <- paste("OutFlow.cm") # changing column names of a data frame
write.csv(dat, "./rr.unified.csv", row.names=F) # save as a new csv file without row names

# Information of Data -----------------------------------------------------

dat.info <- list(name="Hydrological data",
                unit.time="hour",
                unit.rain="cm",
                unit.flow="cm",
                n.time=nrow(dat),
                n.rainyDay=0,
                rain.sum=colSums(dat)[2],
                rain.mean=colMeans(dat)[2],
                rain.peak=sapply(dat, max)[2],
                flow.sum.noBase=0,
                flow.sum=colSums(dat)[3],
                flow.peak=sapply(dat, max)[3],
                flow.baseFlow=(dat[1, 3]+dat[nrow(dat), 3])/2 # Finding discharge
                )
names(dat.info) # display names

# Count the rainy day ---------------------------------------------------------

for(i in 1:dat.info$n.time){    
	if(dat[i,2]!=0){
		dat.info$n.rainyDay <-dat.info$n.rainyDay+1
	}
}

# Removing base flow from discharge ---------------------------------------

i <- 1
while(i<=dat.info$n.time){
	dat$flowWithoutBase[i]<-dat$OutFlow.cm[i]-dat.info$flow.baseFlow
	if(dat$flowWithoutBase[i]<0){
		dat$flowWithoutBase[i]<-0
	}
	i <- i+1
}

dat.info$flow.sum.noBase <-colSums(dat)[4] # Sum of flow without base flow


# Delete attribute names of list -------------------------------------------

for(i in 1:length(dat.info)){
	attr(dat.info[[i]], "names")=NULL
}


# Exporting data information ----------------------------------------------

datInfoEle <- unlist(dat.info) # character
datInfoName <- names(datInfoEle) # extract name value
datInfoVal <- paste(datInfoName, datInfoEle ) # combine two value
write.table(datInfoVal, "./data.info.txt", row.names = FALSE, col.names = FALSE, quote = FALSE)

	</code></pre>


                    <br>
                    <br>
                    <div class="row, inheri">
                        <div class="col-xs-5, col-sm-4">
                            <p>
                                <b>data.rain</b>.<u>csv</u>
                                <br>
                                <img src="index_files/data_002.png" height="350">
                            </p>

                        </div>
                        <div class="col-xs-5, col-sm-4">
                            <p>
                                <b>data.flow</b>.<u>csv</u>
                                <br>
                                <img src="index_files/data_003.png" height="350">
                            </p>

                        </div>
                        <div class="col-xs-12, col-sm-4">
                            <p>
                                <b>rr.unified</b>.<u>csv</u>
                                <br>
                                <img src="index_files/data.png" height="350">
                            </p>

                        </div>
                    </div>



                    <p>
                        <b>data.info</b>.<u>txt</u>
                    </p>
                    <pre style="padding-left: 30pt">names Hydrological data
unit.time hour
unit.rain cm
unit.flow cm
n.time 20
n.rainyDay 13
rain.sum 34.6
rain.max 1.73
rain.peak 8
flow.sum.noBase 31.6
flow.sum 35.58
flow.peak 6
flow.baseFlow 0.2
</pre>

                    <br>

                    <h3 id="importing-data">Importing Data</h3>
                    <pre><code class="r">1 # Importing Data -------------------------------------------------------------
2 
3 rm(list = ls()) # Remove all variable
4 datRain <- read.csv("./data.rain.csv")
5 datFlow <- read.csv("./data.flow.csv")
6 
7 class(datRain) # checking class
8 class(datFlow) # checking class
</code></pre>

                    <br>
                    <p>
                        <i>3</i> : <tt>ls()</tt> 함수는 현재 모든 변수들을 선택한고, 이를 <tt>list</tt> 요소로 <tt>rm()</tt> 함수에 입력하여, 현재 모든 변수를 제거한다.
                        <br>
                        <i>4</i> : <u>"./"</u>는 현재 위치를 말하며, 현재 위치의 <tt>data.rain.csv</tt>파일을 <tt>read.csv()</tt> 함수로 읽어 <tt>datRain</tt> 변수에 할당한다.
                        <br>
                        <i>5</i> : 4번 줄과 마찬가지로 <tt>data.flow.csv</tt>파일을 <tt>read.csv()</tt> 함수로 읽어 <tt>datFlow</tt> 변수에 할당한다.
                        <br>
                        <i>7</i>,<i>8</i> : <tt>datRain</tt>의 <tt>class</tt>를 확인한다. 데이터 타입은 <tt>data.frame</tt>으로 나타날 것이다.
                    </p>

                    <h3 id="exporting-data">Exporting Data</h3>
                    <pre><code class="r">1 # Exporting Data ----------------------------------------------------------
2 
3 dat <- cbind(datRain, datFlow[,2]) # binding data
4 names(dat)[3] <- paste("OutFlow.cm") # changing column names of a data frame
5 write.csv(dat, "./rr.unified.csv", row.names=F) # save as a new csv file without row names</code></pre>

                    <p>
                        <i>3</i> : <tt>datRain</tt>과 <tt>datFlow</tt>의 2번째 열을 <tt>cbind()</tt> 함수로 열(column)기준으로 합처서 <tt>dat</tt> 변수에 할당한다.
                        <br>
                        <i>4</i> : 기본적으로 <tt>dat</tt> 의 3번째 열의 이름이 <tt>datFlow[, 2]</tt>로 할당된다. 이를 <tt>names()</tt> 함수와 <tt>paste()</tt>함수를 사용하여 열이름을 바꾼다.
                        <br>
                        <i>5</i> : <tt>write.csv()</tt> 함수를 사용하여 <tt>rr.unifiedd.csv</tt> 파일로 <tt>dat</tt>를 저장한다. <tt>row.names=F</tt>를 하지 않으면 첫번째 열에 행번호가 붙게 된다.
                    </p>

                    <br>

                    <h3 id="information-of-data">Information of Data</h3>
                    <pre><code class="r"># Information of Data -----------------------------------------------------

1 dat.info <- list(name="Hydrological data",
2                 unit.time="hour",
3                 unit.rain="cm",
4                 unit.flow="cm",
5                 n.time=nrow(dat),
6                 n.rainyDay=0,
7                 rain.sum=colSums(dat)[2],
8                 rain.mean=colMeans(dat)[2],
9                 rain.peak=sapply(dat, max)[2],
10                flow.sum.noBase=0,
11                flow.sum=colSums(dat)[3],
12                flow.peak=sapply(dat, max)[3],
13                flow.baseFlow=(dat[1, 3]+dat[nrow(dat), 3])/2 # Finding discharge
14                )
15 names(dat.info) # display names</code></pre>

                    <br>

                    <p>
                        <i>3</i>~<i>16</i> : list() 함수를 이용하여 dat.info라는 list 데이터 타입의 변수를 만들고, 괄호"()"안에 여러 정보들을 저장한다.
                        <br>
                        <i>3</i>~<i>6</i> : <tt>name</tt>, <tt>unit.time</tt>, <tt>unit.rain</tt>, <tt>unit.flow</tt> 에 character 정보를 입력한다.
                        <br>
                        <i>7</i> : nrow() 함수로 dat의 열 개수를 얻어 총시간을 n.time 요소에 입력한다.
                        <br>
                        <i>8</i> : 비가 온 날 수인 n.rainyDay에 기본값으로 0을 입력한다. (Count the rainy day 섹션에서 계산하여 재할당한다.)
                        <br>
                        <i>9</i> : <tt>colSums()</tt> 함수를 이용하여 <tt>dat</tt>의 2번째 열에 있는 강우량을 전부 더해 <tt>rain.sum</tt>에 입력한다.
                        <br>
                        <i>10</i> : <tt>colMeans()</tt> 함수를 이용하여 <tt>dat</tt>의 2번째 열에 있는 강우량의 평균을 <tt>rain.mean</tt>에 입력한다.
                        <br>
                        <i>11</i> : <tt>sapply()</tt> 함수는 여러 데이터에 특정 함수를 적용하고 싶을 때 사용된다. <tt>dat</tt>에 열방향으로 <tt>max()</tt> 함수를 적용하여 강우량 데이터인 2번째 값만 <tt>rain.peak</tt>에 입력한다.
                        <br>
                        <i>12</i> : 기저유출을 제외한 유출량의 총 합인 flow.sum.noBase 변수에 0을 기본값으로 할당한다. (Removing base flow from discharge 섹션에서 계산하여 제할당한다.)
                        <br>
                        <i>13</i> : 9번 줄과 마찬가지로 <tt>colSums()</tt> 함수를 이용하여 <tt>dat</tt>의 3번째 열에 있는 유출량을 전부 더해 <tt>flow.sum</tt>에 입력한다.
                        <br>
                        <i>14</i> : 11번 줄과 마찬가지로 <tt>sapply()</tt> 함수를 이용하여 <tt>dat</tt>에 열방향으로 <tt>max()</tt> 함수를 적용하여 유출량 데이터인 3번째 값만 <tt>flow.peak</tt>에 입력한다.
                        <br>
                        <i>15</i> : 기저유출을 사상(event)의 처음과 끝의 시간 유출량을 평균으로 가정하여 <tt>flow.baseFlow</tt>에 입력한다. 초기 유출량은 dat의 첫번째 행 3번째 열에 있어 <tt>dat[1,3]</tt>으로 가져올 수 있고, 종기 유출량은 마지막 행에 3번째 열에 있어 <tt>nrow(dat)</tt>로 마지막 행의 index를 이용하여 <tt>dat[nrow(dat),3]</tt>으로 가져올 수 있다.
                        <br>
                        <i>17</i> : <tt>names()</tt> 함수를 이용해서 <tt>dat.info</tt>의 이름값을 출력해 본다.
                    </p>

                    <h3 id="count-the-rainy-day">Count The Rainy Day</h3>
                    <pre><code class="r">1 # Count the rainy day ---------------------------------------------------------
2 
3 for(i in 1:dat.info$n.time){    
4 	if(dat[i,2]!=0){
5 		dat.info$n.rainyDay <-dat.info$n.rainyDay+1
6 	}
7 }</code></pre>
                    <br>

                    <p>
                        <i>3</i>~<i>7</i> : 비가 온 날 수를 세기 위해 <tt>for</tt> 문을 이용하여 반복문을 실행한다. 1부터 시간 수인 <tt>dat.info$n.time</tt>까지 <tt>i</tt>를 반복한다.
                        <br>
                        <i>4</i>~<i>6</i> : if 조건문을 사용하여 비가 온날과 오지 않은 날을 판별한다. 만약 dat[i,2]가 0이 아니면 비가 온것이다.
                        <br>
                        <i>5</i> : 비가 왔다면 <tt>dat.info$n.rainyDay</tt>에 1을 더하여 다시 <tt>dat.info$n.rainyDay</tt>에 입력한다.
                    </p>

                    <h3 id="removing-base-flow-from-discharge">Removing Base Flow from Discharge</h3>
                    
<pre><code class="r">1 # Removing base flow from discharge ---------------------------------------
2 
3 i <- 1
4 while(i<=dat.info$n.time){
5 	dat$flowWithoutBase[i]<-dat$OutFlow.cm[i]-dat.info$flow.baseFlow
6 	if(dat$flowWithoutBase[i]<0){
7 		dat$flowWithoutBase[i]<-0
8 	}
9 	i <- i+1
10 }
11 
12 dat.info$flow.sum.noBase <-colSums(dat)[4] # Sum of flow without base flow</code></pre>
                    <br>

                    <p>
                        <i>3</i> : <tt>while</tt>반복문 조건에 i를 할당하는데 초기값을 1로 지정한다.
                        <br>
                        <i>4</i>~<i>10</i> : 기저유출을 제외한 유출량을 각 시간별로 계산하기 위한 반복문이다. <tt>i</tt>가 <tt>dat.info$n.time</tt>보다 작을 때까지 반복한다.
                        <br>
                        <i>5</i> : i번째의 유출량인 <tt>dat$OutFlow.cm[i]</tt>에서 기저유출인 <tt>dat.info$flow.baseFlow</tt>를 뺴서 기저유출량을 제외한 i번째 유출량인 <tt>dat$flowWithoutBase[i]</tt>에 입력한다.
                        <br>
                        <i>6</i>~<i>8</i> : 만약 <tt>dat$flowWithoutBase[i]</tt>가 0보다 작으면 유출량이 음수값이 나온것이므로 0을 입력한다.
                        <br>
                        <i>9</i> : i에 1을 더하여 다시 i에 입력하여 다음 반복문에 조건에 적용한다.
                        <br>
                        <i>12</i> : <tt>colSum()</tt>함수를 이용하여 기저유출을 제외한 유출총량을 <tt>dat.info$flow.sum.noBase</tt>에 입력한다.
                    </p>

                    <h3 id="delete-attribute-name-of-list">Delete Attribute Names of List</h3>

<pre><code class="r">1 # Delete attribute names of list -------------------------------------------
2 
3 for(i in 1:length(dat.info)){
4 	attr(dat.info[[i]], "names")=NULL
5 }</code></pre>


                    <br>

                    <p>
                        <i>3</i>~<i>5</i> : 반복문을 이용하여 <tt>dat.info</tt> 리스트의 물필요한 <i>names</i> 속성값에 <tt>attr()</tt>함수를 이용해서 <tt>NULL</tt>을 할당하여 제거한다.
                    </p>

                    <h3 id="exporting-data-information">Exporting Data Information</h3>
 
                    <pre><code class="r">1 # Exporting data information ----------------------------------------------
2 
3 datInfoEle <- unlist(dat.info) # character
4 datInfoName <- names(datInfoEle) # extract name value
5 datInfoVal <- paste(datInfoName, datInfoEle ) # combine two value
6 write.table(datInfoVal, "./data.info.txt", row.names = FALSE, col.names = FALSE, quote = FALSE)
</code></pre>

                    <br>

                    <p>
                        <i>3</i> : <tt>unlist()</tt> 함수를 이용해서 <tt>dat.info</tt>를 <tt>character</tt>로 변환한다.
                        <br>
                        <i>4</i> : <tt>names()</tt> 함수를 이용해서 <tt>datInfoEle</tt>의 이름을 추출하여 <tt>datInfoName</tt>에 입력한다.
                        <br>
                        <i>5</i> : <tt>paste()</tt> 함수를 이용해서 <tt>datInfoName</tt>과 <tt>datInfoEle</tt> 각각 대응되는 값들을 붙여서 <tt>datInfoVal</tt>에 입력한다.
                        <br>
                        <i>6</i> : <tt>write.table()</tt> 함수를 이용해서 <tt>datInfoVal</tt>을 <u>"./data.info.txt"</u> 파일로 내보낸다.
                    </p>
            </div>


    </div>



    <div class="top"></div>




</body>


</html>